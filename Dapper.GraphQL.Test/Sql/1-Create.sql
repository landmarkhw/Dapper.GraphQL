CREATE TABLE Person (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	-- Used to identify the person that this has been merged with
	-- (for deduplicating person entities in the db)
	MergedToPersonId INTEGER,
	FirstName VARCHAR(50),
	LastName VARCHAR(50),
	-- Known issue with FK reference to non-null numeric types
	-- https://github.com/StackExchange/Dapper/issues/917
	SupervisorId INTEGER,
	CareerCounselorId INTEGER,
	CreateDate DATE,
	FOREIGN KEY (MergedToPersonId) REFERENCES Person(Id),
	FOREIGN KEY (SupervisorId) REFERENCES Person(Id),
	FOREIGN KEY (CareerCounselorId) REFERENCES Person(Id)
);

CREATE TABLE Company (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	Name VARCHAR(100)
);

CREATE TABLE PersonCompany (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PersonId INTEGER NOT NULL,
	CompanyId INTEGER NOT NULL,
	StartDate DATE NOT NULL,
	EndDate DATE,
	FOREIGN KEY(PersonId) REFERENCES Person(Id),
	FOREIGN KEY(CompanyId) REFERENCES Company(Id)
);

CREATE TABLE Email (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	Address VARCHAR(250)
);

CREATE TABLE PersonEmail (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PersonId INTEGER NOT NULL,
	EmailId INTEGER NOT NULL,
	FOREIGN KEY(PersonId) REFERENCES Person(Id),
	FOREIGN KEY(EmailId) REFERENCES Email(Id)
);

CREATE TABLE CompanyEmail (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	CompanyId INTEGER NOT NULL,
	EmailId INTEGER NOT NULL,
	FOREIGN KEY(CompanyId) REFERENCES Company(Id),
	FOREIGN KEY(EmailId) REFERENCES Email(Id)
);

CREATE TABLE Phone (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	Number VARCHAR(16),
	Type INTEGER
);

CREATE TABLE PersonPhone (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PersonId INTEGER NOT NULL,
	PhoneId INTEGER NOT NULL,
	FOREIGN KEY(PersonId) REFERENCES Person(Id),
	FOREIGN KEY(PhoneId) REFERENCES Phone(Id)
);

CREATE TABLE CompanyPhone (
	Id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	CompanyId INTEGER NOT NULL,
	PhoneId INTEGER NOT NULL,
	FOREIGN KEY(CompanyId) REFERENCES Company(Id),
	FOREIGN KEY(PhoneId) REFERENCES Phone(Id)
);